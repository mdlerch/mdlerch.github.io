<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Michael Lerch" />
        <meta name="copyright" content="Michael Lerch" />

<meta name="keywords" content="email, linux, " />
        <title>Offlineimap, Gmail, and Mutt tutorial - mdlerch
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://mdlerch.com/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://mdlerch.com/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="http://mdlerch.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://mdlerch.com/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://mdlerch.com/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://mdlerch.com/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://mdlerch.com/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://mdlerch.com/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="http://mdlerch.com/theme/images/apple-touch-icon-144x144.png" />
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-54051300-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://mdlerch.com/"><span class=site-name>mdlerch</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://mdlerch.com">Home</a></li>
                            <li ><a href="http://mdlerch.com/pages/about.html">About</a></li>
                            <li ><a href="http://mdlerch.com/pages/projects.html">Projects</a></li>
                            <li ><a href="http://mdlerch.com/categories.html">Categories</a></li>
                            <li ><a href="http://mdlerch.com/tags.html">Tags</a></li>
                            <li ><a href="http://mdlerch.com/archives.html">Archives</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="http://mdlerch.com/offlineimap-gmail-and-mutt-tutorial.html"> Offlineimap, Gmail, and Mutt tutorial  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <h3>History</h3>
<p>A few years ago, I wrote a series of blog posts on offlineimap, mutt, and gmail
(<a href="http://www.miggysmith.wordpress.com/gmail1">Link Here</a>).  Since then, I spent
some time using the gmail web interface for email and then went back to mutt
and used the built in imap.  However, I've realized that neither of these are
as good as using offlineimap and mutt together, which I am back to using.  It
is totally worth the 20 minutes or so to get offlineimap and mutt set up.  This
post will show my offlineimap and mutt configurations.  I will assume you've
already installed offlineimap and mutt.</p>
<h3>Offlineimap</h3>
<p>First, lets get offlineimap set up.  My use case will be pretty simple.  I have
a single Gmail account to which I want to connect and I only want to grab the
INBOX folder.  From this simple scenario, it should be easy to extend to
slightly more complicated scenarios.  Let's pretend that my Gmail user name is
gmail_user and the password is gmail_password. Here's a simple configuration
file (<code>/home/user/.offlineimaprc</code>), which we will explain line by line.</p>
<div class="highlight"><pre><span class="k">[general]</span>
<span class="na">accounts</span> <span class="o">=</span> <span class="s">gmail_user</span>
<span class="na">ui</span> <span class="o">=</span> <span class="s">ttyui</span>
<span class="na">socktimeout</span> <span class="o">=</span> <span class="s">30</span>

<span class="k">[Account gmail_user]</span>
<span class="na">localrepository</span> <span class="o">=</span> <span class="s">local-gmail_user</span>
<span class="na">remoterepository</span> <span class="o">=</span> <span class="s">remote-gmail_user</span>

<span class="k">[Repository local-gmail_user]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">Maildir</span>
<span class="na">localfolders</span> <span class="o">=</span> <span class="s">/home/user/mail/gmail_user</span>

<span class="k">[Repository remote-gmail_user]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">Gmail</span>
<span class="na">remoteuser</span> <span class="o">=</span> <span class="s">gmail_user@gmail.com</span>
<span class="na">remotepass</span> <span class="o">=</span> <span class="s">gmail_password</span>
<span class="na">sslcacertfile</span> <span class="o">=</span> <span class="s">/etc/ssl/certs/ca-certificates.crt</span>
<span class="na">folderfilter</span> <span class="o">=</span> <span class="s">lambda folder: folder in [&#39;INBOX&#39;]</span>
</pre></div>


<h4><code>[general]</code></h4>
<p>In this section, we have to define the accounts, which is the internal to
offlineimap name of accounts that offlineimap should be syncing.  As
described, I only have one.  If you had more, comma separate them (<code>accounts =
gmail_user1, gmail_user2</code>).  I am naming it after my Gmail user name.  The
next two lines are not necessary.  <code>ui</code> sets how fancy the output is when you
run <code>offlineimap</code> in your terminal.  <code>socktimeout</code> is the number of seconds
after which <code>offlineimap</code> should stop trying to connect if it cannot make a
connection.</p>
<h4><code>[Account gmail_user]</code></h4>
<p>Next, we need to name the mail repositories for each account.  Again, I only
have one account so I only need one <code>[Account ...]</code> section.  All we need to do
here is name the local repository (on the computer) and the remote repository
(Gmail) that hold my mail.  I've just named them <code>local-</code> and <code>remote-</code>
followed by my gmail user name.</p>
<h4><code>[Repository local-gmail_user]</code></h4>
<p>Now, I specify how my local respository is set up.  I need to tell it the type
(<code>Maildir</code>) is pretty standard and where it's located in my filesystem
(<code>localfolders</code>).  I'm pretty sure the specified folder must exist before you
run offlineimap: <code>mkdir -p /home/user/mail/gmail_user</code>.</p>
<h4><code>[Repository remote-gmail_user]</code></h4>
<p>Lastly, we specify the Gmail details.  This should be pretty obvious.
<code>remotepass</code> is your Gmail password.  <code>folderfilter</code> is what folders to sync.
As I said, I only want the INBOX.  If you also want, say your sent mail, you
might use</p>
<div class="highlight"><pre><span class="n">folderfilter</span> <span class="o">=</span> <span class="n">lambda</span> <span class="n">folder</span><span class="o">:</span> <span class="n">folder</span> <span class="n">in</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">INBOX</span><span class="sc">&#39; &#39;</span><span class="p">[</span><span class="n">Gmail</span><span class="p">]</span><span class="o">/</span><span class="n">Sent</span> <span class="n">Mail</span><span class="err">&#39;</span><span class="p">]</span>
</pre></div>


<h4>Download your mail</h4>
<p>At this point you should be able to download your mail.  Just run
<code>offlineimap</code> and it should start going.  If you have lots of mail, this will
take a long time.  You can refresh with <code>offlineimap</code> manually whenever you
want.  You might like to set up a cron job to do this in regular intervals.</p>
<h4>Password tips</h4>
<p>I have two step verification on for my google account.  If you do, too, you
might want to set up an "App password" for offlineimap.  To do this, log into
gmail, click your user in the top right corner.  Click Account.  Click
Security.  Click App passwords: Settings.  Then generate one for offlineimap.
Paste the generated code (without spaces) as your <code>remotepass</code> in offlineimap.</p>
<p>If you like to keep your dotfiles on github or some other publicly available
place, you might not like having your password just written out.  Some people
get fancy and integrate with keyrings and such.  I just keep my password stored
in another file (which I don't index on github) and refer to that file in my
main configuration file.  You can do that with offlineimap by utilizing its
python evaluation.  I make a file called <code>/home/user/.offlineimap/password.py</code>
and in it just a single line</p>
<div class="highlight"><pre><span class="n">gmailpassword</span> <span class="o">=</span> <span class="s">&quot;gmail_app_password&quot;</span>
</pre></div>


<p>Now, go back to your <code>/home/user/.offlineimaprc</code> and add this line to
<code>[general]</code></p>
<div class="highlight"><pre><span class="n">pythonfile</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="p">.</span><span class="n">offlineimap</span><span class="o">/</span><span class="n">password</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<p>And change the <code>remotepass</code> line to</p>
<div class="highlight"><pre><span class="n">remotepasseval</span> <span class="o">=</span> <span class="n">gmailpassword</span>
</pre></div>


<p>The extra eval tells offlineimap to evaluate the value as a python expression.</p>
<h3>Mutt</h3>
<p>Now onto configuring mutt.  I'm just going to give the basics configuration.
First, I like to keep my configuration at <code>/home/user/.mutt/muttrc</code> I also have
a <code>/home/user/.mutt/colors.muttrc</code> and some other configuration files all in
that <code>/home/user/.mutt/</code> directory.</p>
<p>Here's a basic muttrc configuration with comments.  Note that I will be using
mutt's built-in smtp for sending mail</p>
<div class="highlight"><pre><span class="cp">## sending mail</span>
<span class="n">set</span> <span class="n">realname</span> <span class="o">=</span> <span class="s">&quot;Michael Lerch&quot;</span>
<span class="n">set</span> <span class="n">reverse_name</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">set</span> <span class="n">from</span> <span class="o">=</span>  <span class="s">&quot;gmail_user@gmail.com&quot;</span>
<span class="n">set</span> <span class="n">smtp_url</span> <span class="o">=</span> <span class="s">&quot;smtp://gmail_user@smtp.gmail.com:587/&quot;</span>
<span class="cp"># file that contains the password</span>
<span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">mutt</span><span class="o">/</span><span class="n">gmailpass</span><span class="p">.</span><span class="n">muttrc</span>

<span class="cp">## appearance</span>
<span class="cp"># this is the best sorting algorithm</span>
<span class="n">set</span> <span class="n">sort</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">threads</span><span class="err">&#39;</span>
<span class="n">set</span> <span class="n">sort_aux</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">reverse</span><span class="o">-</span><span class="n">last</span><span class="o">-</span><span class="n">date</span><span class="o">-</span><span class="n">received</span><span class="err">&#39;</span>

<span class="cp">## receiving mail</span>
<span class="cp"># needs to be consistent with offlineimap!</span>
<span class="n">set</span> <span class="n">mbox_type</span> <span class="o">=</span> <span class="n">Maildir</span>
<span class="n">set</span> <span class="n">folder</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">mail</span><span class="o">/</span><span class="n">gmail_user</span>
<span class="cp"># folder in which to start mutt</span>
<span class="n">set</span> <span class="n">spoolfile</span> <span class="o">=</span> <span class="o">+/</span><span class="n">INBOX</span><span class="o">/</span>
<span class="cp"># cache for even faster</span>
<span class="n">set</span> <span class="n">header_cache</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">mail</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span>

<span class="cp">## writing mail</span>
<span class="cp"># I use vim</span>
<span class="n">set</span> <span class="n">editor</span> <span class="o">=</span> <span class="s">&quot;vim +:silent+/^$ &quot;</span>
</pre></div>


<p>Once again, I have my password stored in a separate file that I source.  That
file contains a single line which is another App password for my google
account:</p>
<div class="highlight"><pre><span class="n">set</span> <span class="n">smtp_pass</span> <span class="o">=</span> <span class="s">&quot;password&quot;</span>
</pre></div>


<p>This should get you started with offlineimap and mutt.  Have you found any
other tricks?</p>
            <aside>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="http://mdlerch.com/tutorial-for-pandoc-citations-markdown-to-latex.html" title="Previous: Tutorial for pandoc citations: markdown to latex">Tutorial for pandoc citations: markdown to latex</a></li>
 
                <li class="next_article"><a href="http://mdlerch.com/fcron-examples-for-every-30-minutes-and-once-a-week.html" title="Next: Fcron examples for every 30 minutes and once a week">Fcron examples for every 30 minutes and once a week</a> »</li>
            </ul>
            </nav>
            </aside>
<section>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2" 
                href="http://mdlerch.com/offlineimap-gmail-and-mutt-tutorial.html/#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body in">
            <div class="accordion-inner">
                <div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mdlerch';
        var disqus_identifier = 'http://mdlerch.com/offlineimap-gmail-and-mutt-tutorial.html';
    var disqus_url = 'http://mdlerch.com/offlineimap-gmail-and-mutt-tutorial.html';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div>
</section>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="mdlerch">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2014-11-09T00:00:00">Nov 9, 2014</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#linux-ref">linux</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#email-ref">email
                    <span>2</span>
</a></li>
            </ul>

        </div>
        </section>
    </div>
    </article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

<script type="text/javascript">
    var disqus_shortname = 'mdlerch';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    </body>
</html>